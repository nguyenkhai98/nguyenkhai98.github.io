# [HTB] Web - C.O.P Write Up!
## By @ndkhai
***
* Link Challenge: `https://app.hackthebox.com/challenges/cop`
* Challenge Description: `The C.O.P (Cult of Pickles) have started up a new web store to sell their merch. We believe that the funds are being used to carry out illicit pickle-based propaganda operations! Investigate the site and try and find a way into their operation!`
***
## Sơ lược tính năng của ứng dụng
1. Giao diện chính của web:

<img width="547" alt="image" src="https://github.com/nguyenkhai98/nguyenkhai98.github.io/assets/51147179/30601320-33d4-4d95-b17c-fc9b0d25977a">

2. Ứng dụng là một web dạng shop bán hàng:
   - Trang chủ list ra danh sách các sản phẩm hiện có.
   - Click vào từng sản phẩm để vào trang thông tin chi tiết sản phẩm.

## Target

Tải source code của ứng dụng về, ta phát hiện thấy có chứa file `flag.txt` ở ngoài thư mục root của ứng dụng. Mục tiêu của chúng ta là phải đọc được nội dung của file này.

![image](https://github.com/nguyenkhai98/nguyenkhai98.github.io/assets/51147179/c8db4efc-b7ff-4ce1-903b-0c60073ef2e1)

## Source code

1. File `Route.py` của ứng dụng, gọi đến các chức năng chính của ứng dụng

```python
@web.route('/')
def index():
    return render_template('index.html', products=shop.all_products())

@web.route('/view/<product_id>')
def product_details(product_id):
    return render_template('item.html', product=shop.select_by_id(product_id))
```

=> Mặc định khi vào trang chủ, ứng dụng sẽ render nội dung của `item.html` kèm theo giá trị được lấy từ hàm `all_products()`. Trong file `models.py` có định nghĩa nội dung của hàm này:
```python
    @staticmethod
    def all_products():
        return query_db('SELECT * FROM products')  
```
Hàm này thực hiện truy vấn đến Database `SELECT * FROM products`. Đến đây ta cần tiếp tục tìm hiểu về bảng products trong Database. Trong file `schema.sql` có nội dung sau:
```sql
CREATE TABLE products (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    data TEXT NOT NULL,
    created_at NOT NULL DEFAULT CURRENT_TIMESTAMP
);
```
=> Qua đây ta xác định được cấu trúc thành phần của bảng `products` gồm 3 columns là: `id`, `data` và `created_at`.
Ngoài ra trong file `database.py`, ta phát hiện ra nhiều nội dung liên quan đến 
